<?xml version="1.0" encoding="utf-8"?>
<Module>
<ModulePrefs title="单位换算" description="提供各种不同计量单位的换算功能" author="迈弄" author_affiliation="迈弄" author_link="http://www.mynon.cn" height="150" scaling="false">
	<Require feature="dynamic-height"/>
</ModulePrefs>
<Content type="html">
<![CDATA[
<style type="text/css">
.wd{padding:2px 0;font-size:12px;}
</style>
<script type="text/javascript">
function showWData(data){
	var data=eval('('+data+')');
	var div = _gel("mn_32");
	var htmlCode='';
	if(data.u && data.t){
		var htmlCode = '<img style="margin-bottom:-3px;width:16px;height:16px;" src="'+unescape(data.i)+'" /> <a href="http://www.mynon.cn/files/bk_click.php?id=m_'+data.w+'&uid='+unescape(data.u)+'&f=os_ty" target="_blank">'+unescape(data.t)+'</a>';
		div.innerHTML=htmlCode;
	}else{
		div.style.display="none";
	}
	_IG_AdjustIFrameHeight();
}
function getWData(wid) {
	var url='http://www.mynon.cn/widget/data/interlink/tianya/'+wid+'/json';
	_IG_FetchContent(url, showWData, {refreshInterval:0});
}
function initWData() {
	var wid=32;
	getWData(wid);
}
_IG_RegisterOnloadHandler(initWData);
</script>
<style type="text/css">
.danwei {
	width:80px;
	margin: 3px 0;
}
input.danwei {
	width:100px;
	margin: 3px 0;
}
</style>
<div style="text-align:center">
<form name="convform">
<select class="danwei" name="type" onchange="fillConvForm(this.form)"><option value="lengths">长度</option><option value="weights">重量</option><option value="area">面积</option><option value="volums">体积</option><option value="temperatures">温度</option><option value="velcity">速度</option><option value="power">功率</option></select><br/>
<input class="danwei" onkeyup="toConvent(this.form,1)" name="lvalue"/>
=
<input class="danwei" onkeyup="toConvent(this.form)" name="rvalue"/><br/>
<select class="danwei" style="margin-right:12px" onchange="toConvent(this.form)" name="lselection"></select><select class="danwei" onchange="toConvent(this.form,1)" name="rselection"></select>
</form></div>
<div id="mn_32" class="wd"></div>
<script type="text/javascript">
var toConvent = function(objForm,reverse){
	with(objForm){
		var cvType = type.options[type.selectedIndex].value;
		if(reverse){
			var fsV = lselection.options[lselection.selectedIndex].value;
			var tsV = rselection.options[rselection.selectedIndex].value;
			var fV = lvalue.value;
		}else{
			var tsV = lselection.options[lselection.selectedIndex].value;
			var fsV = rselection.options[rselection.selectedIndex].value;
			var fV = rvalue.value;
		}
		var tV = doConvent(fsV,tsV,fV,cvType);
		if(reverse){
			rvalue.value = tV;
		}else{
			lvalue.value = tV;
		}
	}
};
var doConvent = function(fsV,tsV,fV,cvType){
	var tempValue = 0;
	if(cvType == "temperatures"){
		if(fsV==1 && tsV==2){
			tempValue = fV*9/5+32;
		}else if(fsV==2 && tsV==1){
			tempValue = (fV-32)*5/9;
		}else{
			tempValue = fV;
		}
	}else{
		var cvF = fsV/tsV;
		tempValue = fV*cvF;
	}
	// Split the result into its integer and decimal fraction parts
	var tmpString = new String(tempValue);
	var tmpValues = tmpString.split (".");
	var retVal = tmpString;
	// Trim the fraction part if it's too long
	if (tmpValues[1] != null && tmpValues[1].length > 9) {
		var eIndex = tmpValues[1].lastIndexOf("e");
		if (eIndex != -1) {
			// keep the scientific notation
			var eString = tmpValues[1].substring(eIndex, tmpValues[1].length);
			retVal = tmpValues[0] + "." + tmpValues[1].substring(0, Math.min(6,eIndex)) + eString;
		} else {
			retVal = tmpValues[0] + "." + tmpValues[1].substring(0, 9);
		}
	}
	return retVal;
};


var cvLengths = new Array(
  new Array("米", 1),
  new Array("公里", 1/0.001),
  new Array("海里", 1/0.0005399568),
  new Array("分米", 1/10),
  new Array("厘米", 1/100),
  new Array("毫米", 1/1000),
  new Array("丝米", 1/10000),
  new Array("忽米", 1/100000),
  new Array("微米", 1/1000000),
  new Array("英寸", 0.0254),
  new Array("英尺", 0.3048),
  new Array("码", 0.9144),
  new Array("英里", 1609.3),
  new Array("市里", 500),
  new Array("市引", 33.3333),
  new Array("市丈", 3.3333),
  new Array("市尺", 0.3333),
  new Array("市寸", 0.03333),
  new Array("市分", 0.003333),
  new Array("市厘", 0.0003333),
  new Array("市毫", 0.00003333)
);
var cvWeights = new Array(
  new Array("公斤", 1),
  new Array("克", 1/1000),
  new Array("吨", 1/0.001),
  new Array("公担", 1/100),
  new Array("分克", 1/10000),
  new Array("厘克", 1/100000),
  new Array("毫克", 1/1000000),
  new Array("磅", 0.4536),
  new Array("盎司", 0.02835),
  new Array("英吨", 1016.0470),
  new Array("美吨", 907.1849),
  new Array("打兰", 0.0017718),
  new Array("格令", 0.0000648),
  new Array("克拉", 0.0002),
  new Array("市担", 50),
  new Array("市斤", 0.5),
  new Array("市两", 0.05),
  new Array("市钱", 0.005),
  new Array("市厘", 0.0005),
  new Array("市毫", 0.00005),
  new Array("市丝", 0.000005)
);
var cvArea = new Array(
  new Array("平方米", 1),
  new Array("平方分米", 1/100),
  new Array("平方厘米", 1/10000),
  new Array("平方公里", 1/0.000001),
  new Array("公顷", 1/0.0001),
  new Array("公亩", 1/0.01),
  new Array("平方英寸", 0.00064516),
  new Array("平方英尺", 0.0929),
  new Array("平方码", 0.8361),
  new Array("英亩", 4046.86),
  new Array("平方英里", 2590000),
  new Array("市顷", 66666.6667),
  new Array("市亩", 666.6667),
  new Array("市分", 66.6667),
  new Array("平方市尺", 0.1111)
);
var cvVolums = new Array(
  new Array("立方米", 1),
  new Array("立方分米", 1/1000),
  new Array("立方厘米", 1/1000000),
  new Array("升", 1/1000),
  new Array("毫升", 1/1000000),
  new Array("英国加仑", 0.0045461),
  new Array("液体加仑", 0.0037854),
  new Array("固体加仑", 0.0044049),
  new Array("立方英寸", 0.0000163871),
  new Array("立方英尺", 0.0283),
  new Array("立方码", 0.7646),
  new Array("立方市寸", 0.000037),
  new Array("立方市尺", 0.037),
  new Array("立方市丈", 37)
);
var cvTemperatures = new Array(
  new Array("摄氏", 1),
  new Array("华氏", 2)
);
//华氏=摄氏*9/5+32
//摄氏=(华氏-32)*5/9
var cvVelcity = new Array(
	new Array("公里/小时",1),
	new Array("英里/小时",1.61),
	new Array("节",1.85)
);
var cvPower = new Array(
	new Array("千瓦",1),
	new Array("马力",0.746)
);
var cvList = new Array(
);
cvList["lengths"] = cvLengths;
cvList["weights"] = cvWeights;
cvList["area"] = cvArea;
cvList["volums"] = cvVolums;
cvList["temperatures"] = cvTemperatures;
cvList["velcity"] = cvVelcity;
cvList["power"] = cvPower;
var fillConvForm = function(objForm){
	with(objForm){
		var cvType = type.options[type.selectedIndex].value;
		var cvA = cvList[cvType];
		lselection.length = 0;
		rselection.length = 0;
		var lcvOpt = null;
		var rcvOpt = null;
		for(var i=0;i<cvA.length;i++){
			lcvOpt = new Option(cvA[i][0],cvA[i][1]);
			rcvOpt = new Option(cvA[i][0],cvA[i][1]);
			lselection.options.add(lcvOpt,i);
			rselection.options.add(rcvOpt,i);
		}
		lvalue.value=1;
		rvalue.value=1;
	}
};
fillConvForm(document.convform);
</script>
]]>
</Content>
</Module>